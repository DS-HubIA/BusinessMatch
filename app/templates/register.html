<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro - Business Match SEBRAE</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .required::after {
            content: " *";
            color: #dc3545;
        }
        .error-message {
            color: #dc3545;
            font-size: 0.875rem;
            display: none;
        }
        .form-control.error {
            border-color: #dc3545;
        }
    </style>
</head>
<body class="bg-light">
    <div class="container">
        <div class="row justify-content-center min-vh-100 align-items-center">
            <div class="col-md-6 col-lg-5">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white text-center">
                        <h4 class="mb-0">Business Match SEBRAE</h4>
                        <small>FE2025 - Cadastro</small>
                    </div>
                    <div class="card-body p-4">
                        <!-- Removido form.hidden_tag() já que não usamos CSRF -->
                        <form id="registerForm" method="POST" action="{{ url_for('auth.register') }}">
                            
                            <!-- Nome Completo -->
                            <div class="mb-3">
                                <label for="name" class="form-label required">Nome Completo</label>
                                <input type="text" class="form-control" id="name" name="name" required>
                                <div class="error-message" id="nameError">Este campo é obrigatório</div>
                            </div>

                            <!-- Email -->
                            <div class="mb-3">
                                <label for="email" class="form-label required">E-mail</label>
                                <input type="email" class="form-control" id="email" name="email" required>
                                <div class="error-message" id="emailError">Digite um e-mail válido</div>
                            </div>

                            <!-- WhatsApp com Máscara -->
                            <div class="mb-3">
                                <label for="phone" class="form-label required">WhatsApp</label>
                                <input type="text" class="form-control" id="phone" name="phone" placeholder="(11) 99999-9999" required maxlength="15">
                                <div class="error-message" id="phoneError">Digite um WhatsApp válido com 11 dígitos</div>
                            </div>

                            <!-- Empresa -->
                            <div class="mb-3">
                                <label for="company" class="form-label required">Empresa</label>
                                <input type="text" class="form-control" id="company" name="company" required>
                                <div class="error-message" id="companyError">Este campo é obrigatório</div>
                            </div>

                            <!-- Porte da Empresa -->
                            <div class="mb-3">
                                <label for="company_size" class="form-label required">Porte da Empresa</label>
                                <select class="form-select" id="company_size" name="company_size" required>
                                    <option value="">Selecione...</option>
                                    <option value="MEI">MEI - Microempreendedor Individual</option>
                                    <option value="ME">ME - Microempresa</option>
                                    <option value="EPP">EPP - Empresa de Pequeno Porte</option>
                                </select>
                                <div class="error-message" id="companySizeError">Selecione o porte da empresa</div>
                            </div>

                            <!-- Senha -->
                            <div class="mb-3">
                                <label for="password" class="form-label required">Senha</label>
                                <input type="password" class="form-control" id="password" name="password" required minlength="6">
                                <div class="error-message" id="passwordError">A senha deve ter pelo menos 6 caracteres</div>
                            </div>

                            <!-- Confirmação de Senha -->
                            <div class="mb-3">
                                <label for="confirm_password" class="form-label required">Confirmar Senha</label>
                                <input type="password" class="form-control" id="confirm_password" name="confirm_password" required>
                                <div class="error-message" id="confirmPasswordError">As senhas não coincidem</div>
                            </div>

                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary btn-lg">Cadastrar</button>
                            </div>
                        </form>

                        <div class="text-center mt-3">
                            <a href="{{ url_for('auth.login') }}" class="text-decoration-none">Já tem uma conta? Faça login</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Máscara para telefone
        document.getElementById('phone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            
            if (value.length <= 11) {
                if (value.length <= 2) {
                    value = value.replace(/^(\d{0,2})/, '($1');
                } else if (value.length <= 7) {
                    value = value.replace(/^(\d{2})(\d{0,5})/, '($1) $2');
                } else {
                    value = value.replace(/^(\d{2})(\d{5})(\d{0,4})/, '($1) $2-$3');
                }
                e.target.value = value;
            }
            
            validatePhone();
        });

        // Validação em tempo real
        function validatePhone() {
            const phoneInput = document.getElementById('phone');
            const phoneError = document.getElementById('phoneError');
            const phoneValue = phoneInput.value.replace(/\D/g, '');
            
            if (phoneValue.length === 11) {
                phoneInput.classList.remove('error');
                phoneError.style.display = 'none';
                return true;
            } else {
                phoneInput.classList.add('error');
                phoneError.style.display = 'block';
                return false;
            }
        }

        // Validação do formulário
        document.getElementById('registerForm').addEventListener('submit', function(e) {
            let isValid = true;
            
            // Validar telefone
            if (!validatePhone()) {
                isValid = false;
            }
            
            // Validar outros campos obrigatórios
            const requiredFields = ['name', 'email', 'company', 'company_size', 'password', 'confirm_password'];
            requiredFields.forEach(field => {
                const input = document.getElementById(field);
                const error = document.getElementById(field + 'Error');
                
                if (!input.value.trim()) {
                    input.classList.add('error');
                    error.style.display = 'block';
                    error.textContent = 'Este campo é obrigatório';
                    isValid = false;
                } else {
                    input.classList.remove('error');
                    error.style.display = 'none';
                }
            });
            
            // Validar email
            const emailInput = document.getElementById('email');
            const emailError = document.getElementById('emailError');
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(emailInput.value)) {
                emailInput.classList.add('error');
                emailError.style.display = 'block';
                isValid = false;
            }
            
            // Validar senha
            const passwordInput = document.getElementById('password');
            const passwordError = document.getElementById('passwordError');
            if (passwordInput.value.length < 6) {
                passwordInput.classList.add('error');
                passwordError.style.display = 'block';
                isValid = false;
            }
            
            // Validar confirmação de senha
            const confirmPasswordInput = document.getElementById('confirm_password');
            const confirmPasswordError = document.getElementById('confirmPasswordError');
            if (passwordInput.value !== confirmPasswordInput.value) {
                confirmPasswordInput.classList.add('error');
                confirmPasswordError.style.display = 'block';
                isValid = false;
            }
            
            if (!isValid) {
                e.preventDefault();
            }
        });

        // Validação em tempo real para outros campos
        document.querySelectorAll('#registerForm input, #registerForm select').forEach(input => {
            input.addEventListener('blur', function() {
                if (!this.value.trim() && this.hasAttribute('required')) {
                    this.classList.add('error');
                    const errorElement = document.getElementById(this.id + 'Error');
                    if (errorElement) {
                        errorElement.style.display = 'block';
                        errorElement.textContent = 'Este campo é obrigatório';
                    }
                } else {
                    this.classList.remove('error');
                    const errorElement = document.getElementById(this.id + 'Error');
                    if (errorElement) {
                        errorElement.style.display = 'none';
                    }
                }
            });
        });
    </script>
</body>
</html>
